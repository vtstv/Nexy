services:
  coturn:
    image: coturn/coturn:latest
    container_name: nexy_coturn
    restart: unless-stopped
    
    ports:
      # STUN/TURN main ports
      - "3478:3478/udp"
      - "3478:3478/tcp"
      # TLS ports (for production)
      - "5349:5349/udp"
      - "5349:5349/tcp"
      # Relay port range (adjust for production)
      - "49160-49200:49160-49200/udp"
    
    volumes:
      - ./turnserver.conf:/etc/coturn/turnserver.conf:ro
      - coturn_logs:/var/log
      # For TLS certificates (production)
      # - ./certs:/etc/coturn/certs:ro
    
    # Override default CMD to prevent auto-detection of external-ip (we set it in config)
    command: ["-c", "/etc/coturn/turnserver.conf", "--log-file=stdout"]
    
    environment:
      # External IP is set in turnserver.conf, don't duplicate here
      - DETECT_RELAY_IP=yes
    
    networks:
      - coturn_network

volumes:
  coturn_logs:

networks:
  coturn_network:
    driver: bridge
