# Coturn TURN/STUN Server Configuration for Nexy Project

# Listening port for STUN/TURN
listening-port=3478

# TLS listening port (for secure connections)
tls-listening-port=5349

# Listening IP address
listening-ip=0.0.0.0

# External IP address (for NAT traversal)
# Set via environment variable EXTERNAL_IP or uncomment and set manually
external-ip=192.168.0.2

# Relay IP: Do NOT set this in Docker! Let coturn bind to 0.0.0.0
# The external-ip will be advertised to clients, but the server binds to all interfaces
# relay-ip should only be set when running on host network or with specific binding requirements

# Verbose logging (disable in production for performance)
verbose

# Fingerprint in TURN messages
fingerprint

# Use long-term credentials mechanism
lt-cred-mech

# Realm for authentication
realm=nexy.local

# Static user credentials (username:password)
# For production, use database authentication instead
user=nexy:nexy_turn_password

# Allow loopback addresses for local development
allow-loopback-peers

# CRITICAL: Allow all private IP ranges for local development
# This is needed because the emulator (10.0.2.x) and Docker (172.x.x.x) use private IPs
# The clients' relay candidates need to communicate with each other

# For local development: explicitly do NOT block any peers
no-multicast-peers

# Don't use dynamic IP filtering
no-dynamic-ip-list

# Explicitly allow ALL peers (development only!)
# Note: This allows relay to any IP including private ranges
allowed-peer-ip=0.0.0.0-255.255.255.255

# DANGEROUS: Disable IP permissions check for local development ONLY
# This eliminates the CREATE_PERMISSION Forbidden IP error
# DO NOT USE IN PRODUCTION
server-relay

# Maximum bandwidth per allocation (1 Mbps)
max-bps=1000000

# Maximum bytes per user (0 = unlimited)
bps-capacity=0

# Total allocation quota (0 = unlimited)
total-quota=0

# User quota (0 = unlimited)
user-quota=0

# Relay port range
# For production, increase range: min-port=49152, max-port=65535
min-port=49160
max-port=49200

# Logging
# For Docker: use syslog
# For standalone: use log file
syslog
# log-file=/var/log/turnserver.log

# Disable CLI
no-cli

# Enable STUN
stun-only=false

# Process runs as root in Docker - comment out for standalone
# For standalone server, uncomment these:
# proc-user=turnserver
# proc-group=turnserver

# TLS Certificate paths (for production with TLS)
# Generate certificates with certbot or openssl
# cert=/etc/coturn/certs/cert.pem
# pkey=/etc/coturn/certs/key.pem

# Disable TLS for local development
# Comment out for production with TLS
no-tls
no-dtls

# Server name
server-name=nexy-turn

# WebRTC compatible settings
mobility

# Enable prometheus metrics (optional)
# Uncomment for monitoring
# prometheus

# Database authentication (optional, for production)
# Uncomment and configure for PostgreSQL-based user management
# psql-userdb="host=postgres dbname=messenger_db user=messenger password=messenger_password"
# psql-table=turn_users

# Redis for persistent state (optional, for production cluster)
# Uncomment for Redis-based session management
# redis-userdb="ip=redis port=6379 dbname=0 password= connect_timeout=30"

# Alternate server (for high availability)
# Uncomment and set backup TURN server
# alternate-server=backup.turn.server.com:3478
