# Coturn TURN/STUN Server Configuration for Nexy Project - PRODUCTION

# Listening port for STUN/TURN
listening-port=3478

# TLS listening port (for secure connections)
tls-listening-port=5349

# Listening IP address
listening-ip=0.0.0.0

# External IP address - REQUIRED for production
# Set via EXTERNAL_IP environment variable or uncomment below
external-ip=${EXTERNAL_IP}

# Relay IP address
relay-ip=0.0.0.0

# Disable verbose logging in production
# verbose

# Fingerprint in TURN messages
fingerprint

# Use long-term credentials mechanism
lt-cred-mech

# Realm for authentication
realm=nexy.local

# Static user credentials
# For production, consider using database authentication
user=nexy:${TURN_PASSWORD}

# Deny loopback in production
# allow-loopback-peers

# Deny peers from private IP ranges
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# Maximum bandwidth per allocation (3 Mbps for HD video)
max-bps=3000000

# Maximum bytes per user (0 = unlimited)
bps-capacity=0

# Total allocation quota
total-quota=0

# User quota
user-quota=0

# Production relay port range
min-port=49152
max-port=65535

# Logging
syslog

# Disable CLI
no-cli

# Enable STUN
stun-only=false

# Run as non-root user (if not in Docker)
# proc-user=turnserver
# proc-group=turnserver

# TLS Certificate paths - REQUIRED for production
cert=/etc/coturn/certs/fullchain.pem
pkey=/etc/coturn/certs/privkey.pem

# Enable TLS in production
# no-tls
# no-dtls

# Cipher list for TLS
cipher-list="ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384"

# Server name
server-name=nexy-turn-prod

# WebRTC compatible settings
mobility

# Enable prometheus metrics
prometheus

# Secure stun (recommended for production)
secure-stun

# Session timeout
max-allocate-lifetime=3600

# Connection timeout
max-allocate-timeout=60

# Database authentication (optional)
# Uncomment and configure for PostgreSQL-based user management
# psql-userdb="host=${DB_HOST} dbname=${DB_NAME} user=${DB_USER} password=${DB_PASSWORD}"

# Redis for session management (optional, for HA)
# redis-userdb="ip=${REDIS_HOST} port=${REDIS_PORT} dbname=0 password=${REDIS_PASSWORD} connect_timeout=30"
